@model IQueryable<DalaWeb.Domain.Entities.Payments.Payment>

@{
    ViewBag.Title = "Платежи";
    DateTime date = (DateTime)ViewBag.date;
}

@if (Model.Any())
{
    
    <h2>
        Платежи абонента @Model.Last().Abonent.Name за @Model.Last().Date.ToString("MMMM") @Model.Last().Date.Year года
    </h2>

    <table class="table table-hover">
        <tr>
            <th>
                Баланс на начало месяца
            </th>
            <th>
                Сумма пополнений
            </th>
            <th>
                Сумма списаний
            </th>
            <th>
                Баланс на конец месяца
            </th>
        </tr>
        <tr>
            <td>
                @Model.Where(x => x.Date < date).Sum(x => x.Sum).ToString("F2")
            </td>
            <td>
                @Model.Where(x => x.Sum > 0).Sum(x=>x.Sum).ToString("F2")
            </td>
            <td>
                @((0 - Model.Where(x => x.Sum < 0).Sum(x => x.Sum)).ToString("F2"))
            </td>
            <td>
                @Model.Where(x=>x.Date < date.AddMonths(1)).Sum(x=>x.Sum).ToString("F2")
            </td>
        </tr>
    </table>

    <p>
        <h3>Подробная выписка по платежам</h3>
    </p> 
    
    <table class="table table-hover">
        <tr>
            <th>
                Дата
            </th>
            <th>
                Сумма
            </th>
            <th>
                Комментарий
            </th>
        </tr>
        @foreach (var item in Model)
        {
            <tr>
                <td align="center">@item.Date.ToShortDateString()</td>
                <td align="center">@item.Sum.ToString("F2")</td>
                <td align="center">@item.Comment</td>
            </tr>
        }
    </table>
}
else
{
    <p>
        У абонента нет платежей в этом месяце
    </p>
}

@Html.ActionLink("Вернуться", "Month")

